<!DOCTYPE html>
<html lang="en">
<head>
  <title>BIGGEN</title>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <link rel="stylesheet" type="text/css" href="styles.css" media="screen" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.rawgit.com/GoogleChrome/pwacompat/v1.0.0/pwacompat.min.js"></script>

  <meta id="theme" name="theme-color" content="#084066" />

  <meta property="og:title" itemprop="name" content="BIGGEN" />
  <meta property="og:type" content="website" />
  <meta property="og:description" itemprop="description" name="description" content="Make text large. Add to your home screen today!" />
  <meta name="twitter:site" content="@samthor" />
  <meta name="twitter:title" content="BIGGEN" />
  <meta name="twitter:description" content="Make text large. Add to your home screen today!" />

  <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-16971638-8', 'auto');
  </script>
  <script>
'use strict';

if ('serviceWorker' in navigator) {
  window.sw = navigator.serviceWorker.register('/sw.js');
  navigator.serviceWorker.addEventListener('controllerchange', function() {
    window.location.reload();
  });
  if (navigator.serviceWorker.controller) {
    const mc = new MessageChannel();
    navigator.serviceWorker.controller.postMessage('version', [mc.port1]);
    mc.port2.onmessage = function(event) {
      console.debug('sw version', event.data);
    };
  } else {
    // probably not on https://
  }
}

  </script>
</head>
<body>

<div id="enter">
  <form>
    <input type="text" placeholder="EMBIGGEN" autofocus />
    <button>&#x2712;</button>
  </form>
  <hr />
  <footer>
    <p>
      <strong>Biggen.pw</strong>, an offline-ready <a href="https://google.com/search?q=progressive+web+app" target="_blank">Progressive Web App</a> for making text big.
      To use, get typing.
    </p>
    <p>
      <a href="https://github.com/samthor/biggen" target="_blank">with &lt;3</a> by <a href="https://twitter.com/samthor" target="_blank">@samthor</a>
    </p>
  </footer>
</div>

<div id="viewport" class="rotate">
  <div id="showcase" hidden></div>
</div>

<script>

var defaultMessages = [
  'EMBIGGEN',
];

function updateURL(replace, search, hash) {
  var url = window.location.pathname;
  if (search === undefined) {
    url += window.location.search;
  } else if (search) {
    url += '?' + search;
  }
  if (hash === undefined) {
    url += window.location.hash;
  } else if (hash) {
    url += '#' + window.encodeURIComponent(hash);
  }
  if (replace) {
    window.history.replaceState(null, null, url);
  } else {
    window.history.pushState(null, null, url);
  }
}

function resizeShowcaseText() {
  var vmax = Math.max(window.innerHeight, window.innerWidth);
  var rect = showcase.getBoundingClientRect();
  var rmax = Math.max(rect.width, rect.height);

  // TODO(samthor): We should instead allow wrap, but for now this is fine.
  if (rmax > vmax * 2) {
    showcase.style.fontSize = '40vmin';
  } else {
    showcase.style.fontSize = null;
  }

  showcase.classList.remove('anim');
  showcase.offsetTop;
  showcase.classList.add('anim');
};

window.onorientationchange = window.onresize = function() {
  viewport.classList.toggle('rotate', window.innerWidth < window.innerHeight);
  resizeShowcaseText();
};

window.onpopstate = function() {
  var mode = window.location.search === '?show';
  var text = window.decodeURIComponent(window.location.hash.substr(1));

  enter.hidden = mode;
  showcase.hidden = !mode;
  document.documentElement.classList.toggle('enabled', mode);
  input.value = text;
  showcase.textContent = text;

  if (mode && !text) {
    var choice = Math.floor(Math.random() * defaultMessages.length);
    showcase.textContent = defaultMessages[choice];
  }
  resizeShowcaseText();

  // set theme-color properly
  theme.setAttribute('content', mode ? '#000000' : '#084066');

  ga('set', 'page', mode ? '/show' : '/');
  ga('send', 'pageview');
};

// nb. only works in fullscreen (ATHS), but that's fine?
//screen && screen.orientation && screen.orientation.lock('landscape');

var input = document.querySelector('input');
function changeHandler() {
  if (!form.hidden) {
    updateURL(true, undefined, input.value);
  }
}
['keydown', 'keyup', 'change'].forEach(function(type) {
  input.addEventListener(type, changeHandler);
});

var form = document.querySelector('form');
form.addEventListener('submit', function(ev) {
  ev.preventDefault();
  updateURL(false, 'show', input.value);
  window.onpopstate();
});

var showcase = document.querySelector('#showcase');
showcase.addEventListener('click', function() {
  updateURL(false, '');
  window.onpopstate();
  ga('send', 'event', 'showcase', 'show', input.value);
});

(function() {
  // For some reason, Chrome likes to refresh us with a '?show/' - trailing slash. Remove it.
  var search = window.location.search || '';
  if (search.match(/\/$/)) {
    window.history.replaceState(null, null, search.substr(0, search.length - 1) + (window.location.hash || ''));
  }
}());

window.onpopstate();
window.onresize();

</script>

</body>
</html>
